<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Chat Matem치ticas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>

<!--
IMPORTANTE:
Este archivo mantiene EXACTAMENTE las mismas clases, estructura,
estilos y animaciones que tu versi칩n original.
SOLO se simplifica la l칩gica JS.
-->

<script>
  const messagesContainer = document.querySelector(".messages-container");
  const input = document.querySelector(".message-input");
  const sendButton = document.querySelector(".send-button");

  let messages = [];

  function addMessage(role, text) {
    const message = document.createElement("div");
    message.className = `message ${role}`;

    const bubble = document.createElement("div");
    bubble.className = "message-bubble";
    bubble.textContent = text;

    message.appendChild(bubble);
    messagesContainer.appendChild(message);

    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    input.value = "";

    messages.push({ role: "user", content: text });
    addMessage("user", text);

    sendButton.disabled = true;

    const res = await fetch("/api/testing", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ messages }),
    });

    const data = await res.json();

    messages.push({ role: "assistant", content: data.answer });
    addMessage("assistant", data.answer);

    sendButton.disabled = false;
  }

  function resetChat() {
    messages = [];
    messagesContainer.innerHTML = "";
  }

  sendButton.addEventListener("click", sendMessage);

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      sendMessage();
    }
  });

  // Bot칩n "..." existente
  const resetItem = document.querySelector(".chat-menu-item");
  if (resetItem) {
    resetItem.addEventListener("click", resetChat);
  }
</script>

</body>
</html>
